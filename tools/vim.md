# VIM 使用


## 基本操作


### 光标移动

1. 按字符移动：`h` `j` `k` `l` 不用说了
2. 按字移动：
    1. `w` -- 向前移动一个字（word）的字首 ；`W` -- 向前移动一个字（忽略特殊字符）的字首
    2. `b` -- 向后移动一个字（word）的字首； `B` -- 向后移动一个字（忽略特殊字符）的字首
    3. `e` -- 向前移动一个字（word）的字尾； `E` -- 向前移动一个字（忽略特殊字符）的字尾
3. 上翻页： `Ctrl+B` （Backward）， 下翻页： `Ctrl+F` （Forward）
4. 行内：`0` -- 行首； `^` -- 行首非空白字符； `$` -- 行尾
5. 整屏内光标移动： `H` （High） -- 屏幕内最顶第一个非空字符； `M`  -- （Middle）屏幕内中间的第一个非空字符； `L` （Low） -- 屏幕内最低端第一个非空字符
6. 文档内： `gg`  -- 文档内第一行第一个非空字符；`G`  -- 文档内最后一行第一个非空字符


### 撤销和恢复

1. `u`（undo）-- 撤销最近一次操作，可连续撤销
2. `Ctrl+r` （redo） -- 恢复最近一次的撤销操作，可连续恢复


### 替换

基本命令格式： `:[addr]s/src_string/dest_string/[option]`

其中：

* [addr] 表示检索范围，省略时表示替换当前行，当然还可以指定查找范围，如：
    * `1,20` 表示在 1~20 行内查找替换
    * `.,$ ` 表示从当前行到文件结尾
    * `%` 表示整个文件内查找替换，等价于 `.,$`
* src_string：查找的字符串
* dest_string：替换的字符串
* [option] 表示操作类型，省略时只替换第一个，还可以：
    * `g`（global） 全局替换
    * `c`（confirm） 替换时需要确认

>**TRICKS：** 如果想将连续的行的行首或行尾插入字符串，可以应用替换命令来完成，vim 中 **`^`** 代表是行首，**`$`** 代表是行尾，例如使用 `:%s/^/hello:` 这条命令表示在所有的行首加上 `hello:` 字符串。

### Vim 可视化模式

vim 中有一种 visual 模式，在普通模式下有三种方法进入该模式：

* 按 **`v`** 进入默认 visual 模式
* 按 **`V`** 进入Line-visual 模式
* 按 **`Ctrl-v`** 进入 Block-visual 模式

在 visual 模式下，上面的光标移动操作同样适用，选中之后，可以使用： 

* **`y`** -- 复制；  **`p`** -- 粘贴；  **`d`** -- 删除


## Vim 进阶

### 多屏操作

* vim 加参数方式
    * `vim -o file1 file2` -- 横向分割显示两个文件
    * `vim -O file1 file2` -- 纵向分割显示两个文件
* 在打开的 vim 中
    * `:sp file` （split）-- 横向分割打开 file 文件
    * `:vs file` （vertical split）-- 纵向分割打开 file 文件
* 将当前文件分成多屏
    * `Ctrl+W s` -- 横向分割当前打开的文件
    * `Ctrl+W v` -- 纵向分割当前打开的文件
* 多屏之间的切换
    * `Ctrl+W h|j|k|l` -- 多个屏之间上下左右切换
    * `Ctrl+W w` -- 多个屏之间来回切换
* 关闭窗口
    * `:q` 或 `:close` 或 `Ctrl+W q` -- 关闭光标所在屏
    * `:only` -- 关闭出光标所在屏的其它屏
    * `:qa` -- 关闭所有屏
* 改变屏的大小
    * `Ctrl+W -|+` -- 使光标所在屏减小|增大高度
    * `Ctrl+W <|>` -- 调整光标所在屏的宽度
    * `Ctrl+W =` -- 使所有屏相等
* 各种中文件同步移动
    * `:set scb` （set scroll bind） -- 设置同步移动
    * `:set scb!` -- 关闭同步移动

## Tips & Tricks

### 1. 临时退出 vim

在使用 vim 时，有时需要临时退出 vim 去 shell 中执行一些命令，完了再回到 vim 中继续操作，如果我们通过保存文件的修改再退出到终端，执行完命令再打开 vim 定位到上次退出的地方，这是非常低效的方法，而且重新打开 vim 之后执行环境和上次也不一样了。这时我们有下面的两种方法：

* **使用 Ctrl+z 和 fg 组合**

`Ctrl+z` 可以将当前正在前台的作业进程放到后台执行，这样就回到 shell 中了，当我们再次想将后台的进程调回前台运行，使用命令 `fg` 即可。

* **在 vim 命令行模式下输入 :sh**

在 vim 命令行模式下输入 `:sh`，即可打开 shell 环境，当需要回到 vim 下时输入 `exit` 即可。


### 2. 在 vim 中执行 shell 命令

进入 vim 的命令行模式，以 **`!`** 开始后接 shell 命令可以在 vim 底部下执行该条命令，而不用退出 vim。


### 3. vim 中重复上次的操作/命令

* 普通模式下：使用 **`.`** 可以重复执行上一次操作。
* 命令行模式下：使用 **`↑`** 可以往上选择历史命令。


## Vim 插件

### Vundle

### ctags

ctags 是 vim 的一个插件，它可以产生标记文件以帮助在源文件中定位对象。

简单的操作：

* `$ ctags -R`   递归地解析当前目录及其子目录的 tags 
* `: Ctrl+]`  跳转到光标所在函数或变量等定义处
* `: Ctrl+t`  跳回原来的位置
* `: ts`  列出当前 tag 的所有引用的地方

## References

* http://www.ibm.com/developerworks/cn/linux/l-cn-tip-vim/
* http://www.ccvita.com/433.html
* 
