# IPC 之共享内存

我们知道每个进程都有自己的独立用户地址空间，在 32 位系统下是 0~3G 的虚拟地址，在进程进行访存操作时，OS 和处理器共同作用下将发出的虚拟地址转化为物理地址，然后去读取实际的内存该地址上的值。**独立** 的意思是，即使两个进程通过相同的虚拟地址但访问到物理地址却不一样的。这样，如果一个进程想访问另一个进程的变量，如果没有其它的机制这是做不到的。但进程之间经常有这种通信的需求，那么本文就介绍一种高效的常用的通信机制————共享内存。

共享内存说简单一点的话，就是操作系统提供一种机制，申请一块物理内存，如果某个进程需要共享这块内存时，就将自己的虚拟地址区间映射到这块物理内存，这样进程可以通过各自的虚拟地址访问到同一块内存了，从而达到通信的目的。

那么共享内存操作提供的几个接口就很简单了，首先需要创建一块共享内存 `shmget`，如果某个进程想映射到这块内存使用 `shmat`，解除映射可以使用 `shmdt`，当然还提供了一些例如修改属性、删除等操作的 `shmctl`。下面就一个个地介绍一下这些接口的基本用法：


## shmget


## shmat


## shmdt


## shmctl



## example





