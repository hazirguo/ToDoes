# sed 基础教程

**sed**（**S**tream **ED**itor），流编辑器，使用程序的方式来编辑输入文本，其中程序是由 sed 支持的操作命令组成的脚本，文本来源可以是标准输入、文件或者是管道，最终输出 sed 编辑之后的文本。

## 格式说明

sed 命令完整的格式：

```
sed [OPTIONS] [SCRIPT] [INPUTFILE]
```

可选的选项主要有以下几个：

* -n：使用安静模式，一般情况所有来自输入流的数据都会输出到屏幕，在安静模式下只有通过 -p 选项处理的那一行才会被输出
* -e *script*：命令行下带编辑文本的脚本，默认是该模式，所以 -e 可以不显示指明
* -f *script-file*：将 sed 脚本程序写在文件 script-file 内
* -i：直接修改读取的文件内容，而不是输出到屏幕上
* -r：支持扩展型正则表达式语法

sed 重点和难点在于其脚本的编写，脚本由一个个编辑动作来组成，动作的基本格式如下：

```
[addr1[,addr2]][!]cmd
```

其中，`cmd` 是 sed 具体的动作命令，sed 支持的命令有插入、替换、删除、打印等，后面将会详细介绍。 若命令前带有 `!`，表示不执行该命令。 `addr1` 和 `addr2` 是 sed 限定该动作处理文本 Address 的说明，也即 sed 执行该动作的条件，只有在处理行满足 Address 的条件下才能执行此次命令。

## Address 的形式

sed 支持多种 Address 表示形式，如果一个动作命令不指定 Address 时，则默认是对所有行进行处理；如果带有一个 Address 说明时，则只有满足 Address 条件的行才处理；如果带有两个 Address 表示一个区间时，两个 Address 说明之间需要用逗号隔开，表示从 addr1 处理到 addr2 为止。

Address 的说明主要有以下几种形式：

* *number*： 一个具体数字，表示文本的第 *number* 行，注意 sed 行号从 1 开始而不是 0。
* *first~step*：表示从第 *first* 开始每隔 *step* 行，例如要处理奇数行，可以使用 `1~2`。
* $：匹配的是文本的最后一行。
* */regexp/*：除了用数字指定行号之后，sed 还支持使用正则表达式来匹配某一行，当该行匹配正则表达式 `regexp` 则处理。
* *\\%regexp%*：也是匹配正则表达式 `regexp`，其中 `%` 可以替换成任意字符。

如果是地址区间的表示形式，sed 还支持一些特殊的表示方法：

* *0, /regexp/*：
* *addr1, +N*：
* *addr1, ~N*：

## sed 基本动作命令说明

### a 命令

**a**（append）命令后紧跟一个需要插入的字符，在需要处理行的下一行插入一行该字符。

### i 命令

**i**（insert）命令与 **a** 命令类似，只不过在需要处理行的上一行插入一行字符。

### c 命令

**c** 命令后接字符串，表示行的整体替换。

### d 命令

**d**（delete）命令后无需接字符串，直接删除指定的行。

### p 命令

**p**（print）命令后也无需接字符串，打印出指定的行。

### s 命令

**s**（substitue）命令是替换某一行中字符串的命令，比较复杂，与 vim 中替换语法类似，格式为 `s/regexp/replacement/flags`。
